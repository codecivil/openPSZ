-- change trafficLight config
UPDATE `os_functions`SET `iconname`= 'traffic-light',`functionmachine`= 'trafficLight',`functionreadable`= 'Ampel',`functionscope`= 'TABLES',`functiontarget`= 'important',`functionconfig`= '{"criteria":[{"name":"zu lange auf Liste Stellungnahme","sql":"SELECT DATEDIFF(CURRENT_DATE(),stellungnahmeseit) from opsz_aufnahme WHERE DATEDIFF(CURRENT_DATE(),stellungnahmeseit) > 41","relation":">","benchmark":"41","urgency":1,"table":"opsz_aufnahme","associated_table":"opsz_aufnahme","display":"Tage"},{"name":"zu lange auf Liste Stellungnahme","sql":"SELECT DATEDIFF(CURRENT_DATE(),stellungnahmeseit) from opsz_aufnahme WHERE DATEDIFF(CURRENT_DATE(),stellungnahmeseit) > 89","relation":">","benchmark":"89","urgency":3,"associated_table":"opsz_aufnahme","table":"opsz_aufnahme"},{"name":"zu lange auf Vermittlungslisten","and":[{"sql":"SELECT DATEDIFF(CURRENT_DATE(),auflisteseit) from opsz_vermittlungslisten WHERE DATEDIFF(CURRENT_DATE(),auflisteseit) > 41","relation":">","benchmark":"41"},{"sql":"SELECT stand from opsz_vermittlungslisten","relation":"!=","benchmark":"erfolgreich"},{"sql":"SELECT stand from opsz_vermittlungslisten","relation":"!=","benchmark":"anderweitig"}],"urgency":1,"associated_table":"opsz_vermittlungslisten","table":"opsz_aufnahme","display":"Tage"},{"name":"zu lange auf Vermittlungslisten","and":[{"sql":"SELECT DATEDIFF(CURRENT_DATE(),auflisteseit) from opsz_vermittlungslisten WHERE DATEDIFF(CURRENT_DATE(),auflisteseit) > 89","relation":">","benchmark":"89"},{"sql":"SELECT stand from opsz_vermittlungslisten","relation":"!=","benchmark":"erfolgreich"},{"sql":"SELECT stand from opsz_vermittlungslisten","relation":"!=","benchmark":"anderweitig"}],"urgency":1,"associated_table":"opsz_vermittlungslisten","table":"opsz_aufnahme","display":"Tage"},{"name":"DolmetscherInnenantrag zu lange ohne Antwort","and":[{"sql":"SELECT DATEDIFF(CURRENT_DATE(),JSON_VALUE(JSON_QUERY(dolmetscherinnenantrag,'$[3]'),'$[0]')) from opsz_vermittlungslisten where JSON_VALUE(JSON_QUERY(dolmetscherinnenantrag,'$[4]'),'$[0]') IS NULL OR JSON_VALUE(JSON_QUERY(dolmetscherinnenantrag,'$[4]'),'$[0]') = ''","relation":">","benchmark":"41","display":"Tage"},{"sql":"SELECT vermittlungsauftrag FROM opsz_vermittlungslisten","benchmark":"","relation":"!=","display":""}],"urgency":3,"associated_table":"opsz_vermittlungslisten","table":"opsz_aufnahme"},{"name":"Therapieantrag zu lange ohne Antwort","and":[{"sql":"SELECT DATEDIFF(CURRENT_DATE(),JSON_VALUE(JSON_QUERY(therapieantrag,'$[3]'),'$[0]')) from opsz_vermittlungslisten where JSON_VALUE(JSON_QUERY(therapieantrag,'$[4]'),'$[0]') IS NULL OR JSON_VALUE(JSON_QUERY(therapienantrag,'$[4]'),'$[0]') = ''","relation":">","benchmark":"41","display":"Tage"},{"sql":"SELECT vermittlungsauftrag FROM opsz_vermittlungslisten","benchmark":"","relation":"!=","display":""}],"urgency":3,"associated_table":"opsz_vermittlungslisten","table":"opsz_aufnahme"},{"name":"Fahrtkostenantrag zu lange ohne Antwort","and":[{"sql":"SELECT DATEDIFF(CURRENT_DATE(),JSON_VALUE(JSON_QUERY(fahrtkostenantrag,'$[4]'),'$[0]')) from opsz_vermittlungslisten where JSON_VALUE(JSON_QUERY(fahrtkostenantrag,'$[5]'),'$[0]') IS NULL OR JSON_VALUE(JSON_QUERY(fahrtkostenantrag,'$[5]'),'$[0]') = ''","relation":">","benchmark":"41","display":"Tage"},{"sql":"SELECT vermittlungsauftrag FROM opsz_vermittlungslisten","benchmark":"","relation":"!=","display":""}],"urgency":3,"associated_table":"opsz_vermittlungslisten","table":"opsz_aufnahme"},{"name":"DolmetscherInnen: Widerspruch zu lange ohne Antwort","and":[{"sql":"SELECT DATEDIFF(CURRENT_DATE(),JSON_VALUE(JSON_QUERY(dolmetscherinnenantrag,'$[10]'),'$[0]')) from opsz_vermittlungslisten where ( JSON_VALUE(JSON_QUERY(dolmetscherinnenantrag,'$[5]'),'$[0]') = 'Ablehnung' OR JSON_VALUE(JSON_QUERY(dolmetscherinnenantrag,'$[5]'),'$[0]') = 'teilweise angenommen' ) AND DATEDIFF(JSON_VALUE(JSON_QUERY(dolmetscherinnenantrag,'$[10]'),'$[0]'),JSON_VALUE(JSON_QUERY(dolmetscherinnenantrag,'$[4]'),'$[0]')) > 0","relation":">","benchmark":"41","display":"Tage"},{"sql":"SELECT vermittlungsauftrag FROM opsz_vermittlungslisten","benchmark":"","relation":"!=","display":""}],"urgency":3,"associated_table":"opsz_vermittlungslisten","table":"opsz_aufnahme"},{"name":"Therapie: Widerspruch zu lange ohne Antwort","and":[{"sql":"SELECT DATEDIFF(CURRENT_DATE(),JSON_VALUE(JSON_QUERY(therapienantrag,'$[10]'),'$[0]')) from opsz_vermittlungslisten where ( JSON_VALUE(JSON_QUERY(therapieantrag,'$[5]'),'$[0]') = 'Ablehnung' OR JSON_VALUE(JSON_QUERY(therapieantrag,'$[5]'),'$[0]') = 'teilweise angenommen' ) AND DATEDIFF(JSON_VALUE(JSON_QUERY(therapieantrag,'$[10]'),'$[0]'),JSON_VALUE(JSON_QUERY(therapieantrag,'$[4]'),'$[0]')) > 0","relation":">","benchmark":"41","display":"Tage"},{"sql":"SELECT vermittlungsauftrag FROM opsz_vermittlungslisten","benchmark":"","relation":"!=","display":""}],"urgency":3,"associated_table":"opsz_vermittlungslisten","table":"opsz_aufnahme"},{"name":"Fahrtkosten: Widerspruch zu lange ohne Antwort","and":[{"sql":"SELECT DATEDIFF(CURRENT_DATE(),JSON_VALUE(JSON_QUERY(fahrtkostenantrag,'$[11]'),'$[0]')) from opsz_vermittlungslisten where ( JSON_VALUE(JSON_QUERY(fahrtkostenantrag,'$[6]'),'$[0]') = 'Ablehnung' OR JSON_VALUE(JSON_QUERY(fahrtkostenantrag,'$[6]'),'$[0]') = 'teilweise angenommen' ) AND DATEDIFF(JSON_VALUE(JSON_QUERY(fahrtkostenantrag,'$[11]'),'$[0]'),JSON_VALUE(JSON_QUERY(fahrtkostenantrag,'$[5]'),'$[0]')) > 0","relation":">","benchmark":"41","display":"Tage"},{"sql":"SELECT vermittlungsauftrag FROM opsz_vermittlungslisten","benchmark":"","relation":"!=","display":""}],"urgency":3,"associated_table":"opsz_vermittlungslisten","table":"opsz_aufnahme"},{"name":"DolmetscherInnen: Ablehnung zu lange ohne Widerspruch","and":[{"sql":"SELECT DATEDIFF(CURRENT_DATE(),JSON_VALUE(JSON_QUERY(dolmetscherinnenantrag,'$[4]'),'$[0]')) from opsz_vermittlungslisten where JSON_VALUE(JSON_QUERY(dolmetscherinnenantrag,'$[5]'),'$[0]') = 'Ablehnung' AND JSON_VALUE(JSON_QUERY(dolmetscherinnenantrag,'$[6]'),'$[0]') != 'ja'","relation":">","benchmark":"13","display":"Tage"},{"sql":"SELECT vermittlungsauftrag FROM opsz_vermittlungslisten","benchmark":"","relation":"!=","display":""}],"urgency":1,"associated_table":"opsz_vermittlungslisten","table":"opsz_aufnahme"},{"name":"Therapie: Ablehnung zu lange ohne Widerspruch","and":[{"sql":"SELECT DATEDIFF(CURRENT_DATE(),JSON_VALUE(JSON_QUERY(therapieantrag,'$[4]'),'$[0]')) from opsz_vermittlungslisten where JSON_VALUE(JSON_QUERY(therapieantrag,'$[5]'),'$[0]') = 'Ablehnung' AND JSON_VALUE(JSON_QUERY(therapieantrag,'$[6]'),'$[0]') != 'ja'","relation":">","benchmark":"13","display":"Tage"},{"sql":"SELECT vermittlungsauftrag FROM opsz_vermittlungslisten","benchmark":"","relation":"!=","display":""}],"urgency":1,"associated_table":"opsz_vermittlungslisten","table":"opsz_aufnahme"},{"name":"Fahrtkosten: Ablehnung zu lange ohne Widerspruch","and":[{"sql":"SELECT DATEDIFF(CURRENT_DATE(),JSON_VALUE(JSON_QUERY(fahrtkostenantrag,'$[5]'),'$[0]')) from opsz_vermittlungslisten where JSON_VALUE(JSON_QUERY(fahrtkostenantrag,'$[6]'),'$[0]') = 'Ablehnung' AND JSON_VALUE(JSON_QUERY(fahrtkostenantrag,'$[7]'),'$[0]') != 'ja'","relation":">","benchmark":"13","display":"Tage"},{"sql":"SELECT vermittlungsauftrag FROM opsz_vermittlungslisten","benchmark":"","relation":"!=","display":""}],"urgency":1,"associated_table":"opsz_vermittlungslisten","table":"opsz_aufnahme"},{"name":"DolmetscherInnen: Ablehnung zu lange ohne Widerspruch","and":[{"sql":"SELECT DATEDIFF(CURRENT_DATE(),JSON_VALUE(JSON_QUERY(dolmetscherinnenantrag,'$[4]'),'$[0]')) from opsz_vermittlungslisten where JSON_VALUE(JSON_QUERY(dolmetscherinnenantrag,'$[5]'),'$[0]') = 'Ablehnung' AND JSON_VALUE(JSON_QUERY(dolmetscherinnenantrag,'$[6]'),'$[0]') != 'ja'","relation":">","benchmark":"20","display":"Tage"},{"sql":"SELECT vermittlungsauftrag FROM opsz_vermittlungslisten","benchmark":"","relation":"!=","display":""}],"urgency":3,"associated_table":"opsz_vermittlungslisten","table":"opsz_aufnahme"},{"name":"Therapie: Ablehnung zu lange ohne Widerspruch","and":[{"sql":"SELECT DATEDIFF(CURRENT_DATE(),JSON_VALUE(JSON_QUERY(therapieantrag,'$[4]'),'$[0]')) from opsz_vermittlungslisten where JSON_VALUE(JSON_QUERY(therapieantrag,'$[5]'),'$[0]') = 'Ablehnung' AND JSON_VALUE(JSON_QUERY(therapieantrag,'$[6]'),'$[0]') != 'ja'","relation":">","benchmark":"20","display":"Tage"},{"sql":"SELECT vermittlungsauftrag FROM opsz_vermittlungslisten","benchmark":"","relation":"!=","display":""}],"urgency":3,"associated_table":"opsz_vermittlungslisten","table":"opsz_aufnahme"},{"name":"Fahrtkosten: Ablehnung zu lange ohne Widerspruch","and":[{"sql":"SELECT DATEDIFF(CURRENT_DATE(),JSON_VALUE(JSON_QUERY(fahrtkostenantrag,'$[5]'),'$[0]')) from opsz_vermittlungslisten where JSON_VALUE(JSON_QUERY(fahrtkostenantrag,'$[6]'),'$[0]') = 'Ablehnung' AND JSON_VALUE(JSON_QUERY(fahrtkostenantrag,'$[7]'),'$[0]') != 'ja'","relation":">","benchmark":"20","display":"Tage"},{"sql":"SELECT vermittlungsauftrag FROM opsz_vermittlungslisten","benchmark":"","relation":"!=","display":""}],"urgency":3,"associated_table":"opsz_vermittlungslisten","table":"opsz_aufnahme"},{"name":"zu viele Termine in 6 Monaten und nur OS","notimplies":[{"sql":"SELECT count(id_opsz_aufnahme) from opsz_termine WHERE beginn < CURRENT_DATE() AND beginn >= DATE_ADD(CURRENT_DATE(), INTERVAL -6 MONTH)","relation":">=","benchmark":"5","display":""},{"sql":"SELECT count(id_opsz_aufnahme) from opsz_termine WHERE beginn < CURRENT_DATE() AND beginn >= DATE_ADD(CURRENT_DATE(), INTERVAL -6 MONTH) AND typ != 'OS'","relation":">","benchmark":"0"}],"urgency":1,"associated_table":"opsz_termine","table":"opsz_aufnahme"},{"name":"zu viele Termine in 6 Monaten und nur OS","notimplies":[{"sql":"SELECT count(id_opsz_aufnahme) from opsz_termine WHERE beginn < CURRENT_DATE() AND beginn >= DATE_ADD(CURRENT_DATE(), INTERVAL -6 MONTH)","relation":">=","benchmark":"10"},{"sql":"SELECT count(id_opsz_aufnahme) from opsz_termine WHERE beginn < CURRENT_DATE() AND beginn >= DATE_ADD(CURRENT_DATE(), INTERVAL -6 MONTH) AND typ != 'OS'","relation":">","benchmark":"0"}],"urgency":2,"associated_table":"opsz_termine","table":"opsz_aufnahme"},{"name":"zu viele Termine in 6 Monaten und nur OS","notimplies":[{"sql":"SELECT count(id_opsz_aufnahme) from opsz_termine WHERE beginn < CURRENT_DATE() AND beginn >= DATE_ADD(CURRENT_DATE(), INTERVAL -6 MONTH)","relation":">=","benchmark":"20"},{"sql":"SELECT count(id_opsz_aufnahme) from opsz_termine WHERE beginn < CURRENT_DATE() AND beginn >= DATE_ADD(CURRENT_DATE(), INTERVAL -6 MONTH) AND typ != 'OS'","relation":">","benchmark":"0"}],"urgency":3,"associated_table":"opsz_termine","table":"opsz_aufnahme"},{"name":"Erinnerung an BaDo","and":[{"sql":"SELECT count(id_opsz_aufnahme) FROM opsz_termine WHERE typ !='*Sonstige' AND typ !='Vermittlung' AND stattgefunden = '*Ja'","relation":">=","benchmark":"2"},{"sql":"SELECT standderakte FROM opsz_refukey","relation":"!=","benchmark":"geschlossen"},{"sql":"SELECT badoiiausgefuellt FROM opsz_refukey","relation":"!=","benchmark":"ja"},{"sql":"SELECT aktiv FROM opsz_aufnahme","relation":"!=","benchmark":"nein"},{"or":[{"sql":"SELECT dropout FROM opsz_refukey","relation":"=","benchmark":"*keine"},{"sql":"SELECT dropout FROM opsz_refukey","relation":"=","benchmark":""}]}],"urgency":1,"associated_table":"opsz_refukey","table":"opsz_aufnahme"},{"name":"Erinnerung an refuKey I","and":[{"sql":"SELECT count(id_opsz_aufnahme) FROM opsz_termine WHERE typ !='*Sonstige' AND typ !='Vermittlung' AND stattgefunden = '*Ja'","relation":">=","benchmark":"3"},{"sql":"SELECT standderakte from opsz_refukey","relation":"!=","benchmark":"geschlossen"},{"sql":"SELECT standderakte from opsz_refukey","relation":"!=","benchmark":"vermittelt"},{"sql":"SELECT refukeyiausgefuellt from opsz_refukey","relation":"!=","benchmark":"ja"},{"or":[{"sql":"SELECT dropout FROM opsz_refukey","relation":"=","benchmark":"*keine"},{"sql":"SELECT dropout FROM opsz_refukey","relation":"=","benchmark":""}]},{"sql":"SELECT aktiv from opsz_aufnahme","relation":"!=","benchmark":"nein"},{"sql":"SELECT evalnoeval from opsz_refukey","relation":"=","benchmark":""}],"urgency":1,"associated_table":"opsz_refukey","table":"opsz_aufnahme"},{"name":"Erinnerung an refuKey II","and":[{"sql":"SELECT count(opsz_termine.id_opsz_aufnahme) from opsz_termine inner join opsz_refukey using (id_opsz_aufnahme) WHERE beginn > refkeyiausgefuelltam AND stattgefunden = '*Ja'","relation":">=","benchmark":"9"},{"sql":"SELECT refukeyiiausgefuelltzehn from opsz_refukey","relation":"!=","benchmark":"ja"},{"sql":"SELECT standderakte from opsz_refukey","relation":"!=","benchmark":"geschlossen"},{"sql":"SELECT standderakte from opsz_refukey","relation":"!=","benchmark":"vermittelt"},{"or":[{"sql":"SELECT dropout FROM opsz_refukey","relation":"=","benchmark":"*keine"},{"sql":"SELECT dropout FROM opsz_refukey","relation":"=","benchmark":""}]},{"sql":"SELECT aktiv from opsz_aufnahme","relation":"!=","benchmark":"nein"},{"sql":"SELECT evalnoeval from opsz_refukey","relation":"=","benchmark":""}],"urgency":1,"associated_table":"opsz_refukey","table":"opsz_aufnahme"}],"identifiers":{"opsz_aufnahme":["name","vorname"]}}' WHERE `functionmachine`= 'trafficLight';

-- insert new date field for widersprüche
